---
layout:     post
title:      "Flutterç”ŸæˆäºŒç»´ç å¹¶ä¿å­˜å›¾ç‰‡åˆ°ç›¸å†Œ"
subtitle:   " ğŸ· "
date:       2021-04-09 12:00:00
author:     "Hiz"
header-img: "img/flutter.jpg"
catalog: true
tags:
    - Flutter
    - Dart
---

# å‰è¨€
åœ¨é¡¹ç›®ä¸­ç”ŸæˆäºŒç»´ç å¹¶ä¿å­˜åˆ°ç›¸å†Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„éœ€æ±‚ã€

# å®‰è£…ç›¸å…³ä¾èµ–

åœ¨`pubspec.yaml`ä¸­åŠ å…¥ä»¥ä¸‹ä¾èµ–

```yaml
# äºŒç»´ç 
qr_flutter: ^4.0.0
# è·å–æƒé™
permission_handler: "^6.1.1"
# ä¿å­˜å›¾ç‰‡åˆ°ç›¸å†Œ
image_gallery_saver: '^1.6.8'
```

# ç”ŸæˆäºŒç»´ç 
åœ¨éœ€è¦ç”ŸæˆäºŒç»´ç çš„é¡µé¢å¼•å…¥`qr_flutter`

```dart
// å¼•å…¥ä¾èµ–
import 'package:qr_flutter/qr_flutter.dart';

// ç”ŸæˆäºŒç»´ç 
QrImage(
  data: "1234567890",
  version: QrVersions.auto,
  size: 150.0,
)

// è¿˜å¯ä»¥è®¾ç½®èƒŒæ™¯é¢œè‰²ï¼Œpaddingç­‰å¾ˆå¤šé€‰é¡¹
```
[ç‚¹å‡»æŸ¥çœ‹æ›´å¤š](https://pub.flutter-io.cn/packages/qr_flutter)

# ç”Ÿæˆå›¾ç‰‡å¹¶ä¿å­˜è‡³ç›¸å†Œ

* å¼•å…¥ä¾èµ–

  ```dart
    import 'package:image_gallery_saver/image_gallery_saver.dart';
    import 'package:permission_handler/permission_handler.dart';
  ```

* iosä¸‹éœ€è¦ç¼–è¾‘ä¸‹Info.plistï¼ŒåŠ å…¥éœ€è¦å¼€å¯çš„æƒé™,åªéœ€å¼€å¯Photoså³å¯

  ```xml
  <!-- Permission options for the `location` group -->
    <key>NSLocationWhenInUseUsageDescription</key>
    <string>Need location when in use</string>
    <key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
    <string>Always and when in use!</string>
    <key>NSLocationUsageDescription</key>
    <string>Older devices need location.</string>
    <key>NSLocationAlwaysUsageDescription</key>
    <string>Can I haz location always?</string>

    <!-- Permission options for the `mediaLibrary` group -->
    <key>NSAppleMusicUsageDescription</key>
    <string>Music!</string>
    <key>kTCCServiceMediaLibrary</key>
    <string>media</string>

    <!-- Permission options for the `calendar` group -->
    <key>NSCalendarsUsageDescription</key>
    <string>Calendars</string>

    <!-- Permission options for the `camera` group -->
    <key>NSCameraUsageDescription</key>
    <string>camera</string>

    <!-- Permission options for the `contacts` group -->
    <key>NSContactsUsageDescription</key>
    <string>contacts</string>

    <!-- Permission options for the `microphone` group -->
    <key>NSMicrophoneUsageDescription</key>
    <string>microphone</string>

    <!-- Permission options for the `speech` group -->
    <key>NSSpeechRecognitionUsageDescription</key>
    <string>speech</string>

    <!-- Permission options for the `sensors` group -->
    <key>NSMotionUsageDescription</key>
    <string>motion</string>

    <!-- Permission options for the `photos` group -->
    <key>NSPhotoLibraryUsageDescription</key>
    <string>photos</string>

    <!-- Permission options for the `reminder` group -->
    <key>NSRemindersUsageDescription</key>
    <string>reminders</string>
  ```
* ç”Ÿæˆå›¾ç‰‡å¹¶ä¿å­˜è‡³ç›¸å†Œ

  ```dart
  /// ç”Ÿæˆå›¾ç‰‡å¹¶ä¿å­˜è‡³ç›¸å†Œ
  Future<Uint8List> _capturePng() async {
    try {
      RenderRepaintBoundary boundary =
          repaintWidgetKey.currentContext.findRenderObject();
      var image = await boundary.toImage(pixelRatio: 3.0);
      ByteData byteData =
          await image.toByteData(format: ui.ImageByteFormat.png);
      Uint8List pngBytes = byteData.buffer.asUint8List();
      print('=========>pngBytes');
      print(pngBytes);

      // åˆ¤æ–­æ˜¯å¦å¼€å¯ç›¸å†Œæƒé™
      var status = await Permission.photos.status;
      print('photos status: $status');
      if (status.isDenied) {
        print('denied');

        // å¼€å¯ç›¸å†Œæƒé™
        Map<Permission, PermissionStatus> statuses =
            await [Permission.photos].request();

        print('photos status: $status');
        if (status.isGranted) {
          print('=====>photos:isGranted');
        }

        print('=====>statuses:$statuses');
      }
      // ä¿å­˜å›¾ç‰‡åˆ°ç›¸å†Œ
      final result = await ImageGallerySaver.saveImage(
          pngBytes.buffer.asUint8List(),
          quality: 60,
          name: 'test');
      print('=========>save result:$result');
      // ä¿å­˜æˆåŠŸ
      String msg = result['isSuccess'] ? 'å·²ä¿å­˜è‡³ç›¸å†Œ' : 'ä¿å­˜å¤±è´¥';

      Fluttertoast.showToast(
          msg: msg,
          toastLength: Toast.LENGTH_SHORT,
          gravity: ToastGravity.TOP,
          timeInSecForIosWeb: 1,
          backgroundColor: Colors.blue,
          textColor: Colors.white,
          fontSize: 16.0);
      return pngBytes;
    } catch (e) {
      print(e);
    }
    return null;
  }

  GestureDetector(
    child: Container(
      width: 100,
      height: 50,
      color: Colors.red,
      alignment: Alignment.center,
      child: Text('ç”Ÿæˆå›¾ç‰‡',
          style: TextStyle(color: Colors.white, fontSize: 20)),
    ),
    onTap: () => _capturePng()
  )
  ```
ä¸»è¦å°±æ˜¯åˆ¤æ–­ä¸‹è®¾å¤‡æ˜¯å¦å¼€å¯äº†ç›¸å†Œçš„æƒé™ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯éœ€è¦å¼•å¯¼ç”¨æˆ·å¼€å¯æƒé™åæ‰å¯ä»¥ä¿å­˜å›¾ç‰‡ã€‚

