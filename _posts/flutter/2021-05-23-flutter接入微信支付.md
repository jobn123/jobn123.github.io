---
layout:     post
title:      "flutteræ¥å…¥å¾®ä¿¡æ”¯ä»˜"
subtitle:   " ğŸ· "
date:       2021-05-23 12:00:00
author:     "Hiz"
header-img: "img/flutter.jpg"
catalog: true
tags:
    - Flutter
---

# iOS æ”¯ä»˜

* é…ç½®`URL Schemes` ï¼Œå†…å®¹ä¸ºåº”ç”¨çš„`AppID`, å¯ä»¥ç™»å½•å¾®ä¿¡å¼€æ”¾å¹³å°æŸ¥çœ‹ã€‚ç¼–è¾‘`ios/Runner/Info.plist`

  ```xml
  <key>CFBundleURLSchemes</key>
  <array>
    <string>wx84cxxxxxx</string>
  </array>
  ```

* é…ç½®`LSApplicationQueriesSchemes`

  ![image-20210523140138835](https://gitee.com/inkkk0516/typora/raw/master/image-20210523140138835.png)

* ä½¿ç”¨

  ```dart
  await fluwx.registerWxApi(
            appId: "wx84cfexxxxxx",
            universalLink: "https://www.xxxx.cn/app/");
  
  fluwx.payWithWeChat(
    appId: result['appid'],
    partnerId: result['partnerid'],
    prepayId: result['prepayid'],
    packageValue: result['package'],
    nonceStr: result['noncestr'],
    timeStamp: result['timestamp'],
    sign: result['sign'],
  )
  ```

  

# å®‰å“æ”¯ä»˜

* ç™»å½•[å¾®ä¿¡å¼€æ”¾å¹³å°](https://open.weixin.qq.com/cgi-bin/index?t=home/index&lang=zh_CN&token=f3443bb5b660c02dbbc86fb324adce3239e5ab22),å¡«å†™ç›¸å…³ä¿¡æ¯

![image-20210523132928727](https://gitee.com/inkkk0516/typora/raw/master/image-20210523132928727.png)

* æ ¹æ®`åº”ç”¨åŒ…å`ç”Ÿæˆ`åº”ç”¨ç­¾å` [ç‚¹å‡»è¿™é‡Œä¸‹è½½åº”ç”¨ç­¾åå·¥å…·](https://developers.weixin.qq.com/doc/oplatform/Downloads/Android_Resource.html), å®‰è£…å¥½ç­¾åå·¥å…·åï¼Œè¾“å…¥åº”ç”¨åŒ…åå°±å¯ä»¥ç”Ÿæˆåº”ç”¨ç­¾åäº†

![image-20210523133551034](https://gitee.com/inkkk0516/typora/raw/master/image-20210523133551034.png)

* åœ¨`android/app/build.gradle`ä¸­é…ç½®ä¾èµ–

  ```shell
  dependencies {
      implementation 'com.tencent.mm.opensdk:wechat-sdk-android-without-mta:+'
  }
  ```

* åœ¨å®‰å“é¡¹ç›®åŒ…åç›®å½•ä¸‹åˆ›å»ºå¾®ä¿¡å›è°ƒé¡µé¢`WXPayEntryActivity.java`

  ```java
  package cn.pokedo.app.wxapi;
  import com.jarvan.fluwx.wxapi.FluwxWXEntryActivity;
  
  public class WXPayEntryActivity extends FluwxWXEntryActivity {
  }
  ```

* åœ¨`AndroidManifest.xml`ä¸­é…ç½®

  ```xml
  <!-- å®‰å“å¾®ä¿¡æ”¯ä»˜ START -->
    <activity
        android:name=".wxapi.WXPayEntryActivity"
        android:exported="true"
        android:launchMode="singleTop">
        <intent-filter>
            <action android:name="android.intent.action.VIEW"/>
            <category android:name="android.intent.category.DEFAULT"/>
            <data android:scheme="wx84cfe5cd6c843545"/>
        </intent-filter>
    </activity>
    <!-- å®‰å“å¾®ä¿¡æ”¯ä»˜ END -->
  ```

* ä½¿ç”¨

  ```dart
  // æ³¨å†Œ
  await fluwx.registerWxApi(
            appId: "wx84cxxxxxx",
            universalLink: "https://www.xxxx.cn/app/");
  
  // ç›‘å¬æ”¯ä»˜ç»“æœ
  fluwx.weChatResponseEventHandler.listen((event) async {
    print(event.errCode);
  	// æ”¯ä»˜æˆåŠŸ  
    if (event.errCode == 0) {
    }
    // å…³é—­å¼¹çª—
  });
  ```

  