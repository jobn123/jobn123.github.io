---
layout:     post
title:      "Docker "
subtitle:   "ğŸ³"
date:       2021-01-01 12:00:00
author:     "Hiz"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - æŠ€æœ¯
    - Docker
---

# Dockerç®€ä»‹

## ä½œç”¨

* æ‰“åŒ…ã€éš”ç¦»ä¸€ä¸ªä¸ªå®¹å™¨ï¼Œäº’ç›¸ä¸å½±å“

* é€šè¿‡é•œåƒæ‰“åŒ…è§£å†³å¼€å‘ä¸­çš„ç¯å¢ƒé…ç½®é—®é¢˜

##  Dockerå†å²

* 2010å¹´dotcloudå…¬å¸ï¼Œåšpassäº‘è®¡ç®—æœåŠ¡

* ç ”å‘çš„å®¹å™¨åŒ–æŠ€æœ¯å‘½åDockerï¼Œå¹¶æ²¡æœ‰å¼•èµ·è¡Œä¸šæ³¨æ„

* 2013å¹´å¼€æºï¼Œå¼•èµ·è¡Œä¸šæ³¨æ„

* DockeråŸºäºGoè¯­è¨€å¼€å‘

## Dockerèƒ½å¹²å˜›

**ä¼ ç»Ÿè™šæ‹Ÿæœº**

* èµ„æºå ç”¨å¤š

* å†—ä½™å¤šï¼Œæ­¥éª¤å¤š

* å¯åŠ¨æ¼«ï¼Œéƒ¨ç½²éº»çƒ¦

**Docker**

* å®¹å™¨åŒ–æŠ€æœ¯ï¼ŒèŠ‚çœèµ„æº
* å®¹å™¨é—´äº’ç›¸éš”ç¦»ï¼Œä¸å—å½±å“
* åº”ç”¨æ›´å¿«çš„äº¤ä»˜ã€éƒ¨ç½²
* æ›´ä¾¿æ·çš„å‡çº§ä¸æ‰©å®¹
* æ›´ç®€å•çš„è¿ç»´æœåŠ¡

## Dockerçš„åŸºæœ¬ç»„æˆ

\* é•œåƒï¼ˆimagesï¼‰ï¼šé€šè¿‡é•œåƒåˆ›å»ºå®¹å™¨æœåŠ¡

\* å®¹å™¨ï¼ˆï¼‰ï¼š ç‹¬ç«‹è¿è¡Œä¸€ä¸ªæˆ–è€…ä¸€ä¸ªç»„åº”ç”¨ï¼Œé€šè¿‡é•œåƒåˆ›å»ºï¼Œå¯ä»¥å¯åŠ¨åˆ é™¤æš‚åœã€‚

\* ä»“åº“ï¼š å­˜å‚¨ é•œåƒçš„åœ°æ–¹

## Docker run æµç¨‹

\* Dockeråœ¨æœ¬åœ°æŸ¥æ‰¾ï¼Œæœ‰çš„è¯ç›´æ¥ä½¿ç”¨ï¼Œæ²¡æœ‰çš„è¯å»dockerHubä¸‹è½½ï¼ŒDokcerhubæŸ¥æ‰¾åˆ°ä¹‹åä¸‹è½½å¹¶è¿è¡Œ

## Docker æ˜¯æ€ä¹ˆå·¥ä½œçš„

docker æ˜¯ä¸€ä¸ªClient-Serverç»“æ„çš„ç³»ç»Ÿï¼Œ Dockerçš„å®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸»æœºä¸Šï¼Œé€šè¿‡Socketä»å®¢æˆ·ç«¯è®¿é—®ï¼Docker Serveræ”¶åˆ°Clientçš„æŒ‡ä»¤å°±ä¼šæ‰§è¡Œï¼

# Dockerå¸¸ç”¨å‘½ä»¤

## å¸®åŠ©å‘½ä»¤

```shell
docker version
docker info 
docker å‘½ä»¤ --help
```

##  é•œåƒå‘½ä»¤

*docker images* æŸ¥çœ‹æœ¬åœ°ä¸»æœºä¸Šæ‰€æœ‰é•œåƒ

```shell
docker images
REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE
docker/getting-started   latest              021a1b85e641        3 weeks ago         27.6MB
alpine/git               latest              76a4083eacef        6 weeks ago         28.4MB

# å¯é€‰é¡¹
-a, -all 					# åˆ—å‡ºæ‰€æœ‰é•œåƒ
-q, -- quiet      # åªæ˜¾ç¤ºé•œåƒid
```

*docker search* æœç´¢é•œåƒ

 ```shell
docker search mysql

# å¯é€‰é¡¹
-f, --filter=STARS=3000    # æœç´¢å‡ºæ¥é•œåƒSTARå¤§äº3000çš„
 ```

*docker pull* ä¸‹è½½é•œåƒ

```shell
docker pull mysql  			# é»˜è®¤ä¸‹è½½latest

docker pull mysql:5.7 	# ä¸‹è½½æŒ‡å®šç‰ˆæœ¬
```

 *docker rmi* åˆ é™¤é•œåƒ

```shell
docker rmi -f é•œåƒid 								 # åˆ é™¤æŒ‡å®šå®¹å™¨
docker rmi -f é•œåƒid é•œåƒid é•œåƒid 		# åˆ é™¤å¤šä¸ªå®¹å™¨
docker rmi -f $(docker images -ap)  # åˆ é™¤å…¨éƒ¨å®¹å™¨
```

## å®¹å™¨å‘½ä»¤

*è¯´æ˜ï¼š æœ‰äº†é•œåƒæ‰èƒ½åˆ›å»ºå®¹å™¨*

*æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨*

```shell
docker run [å¯é€‰å‚æ•°] image 

# å‚æ•°è¯´æ˜
--name='Name'     å®¹å™¨çš„åå­—
-d								åå°æ–¹å¼è¿è¡Œ
-it								ä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹å†…å®¹
-p								æŒ‡å®šå®¹å™¨ç«¯å£ -p 8080:8080
		-p ip:ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£
		-p ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£ï¼ˆå¸¸ç”¨ï¼‰
		-p å®¹å™¨ç«¯å£
		å®¹å™¨ç«¯å£
-P								éšæœºæŒ‡å®šç«¯å£

# æµ‹è¯•
# å¯åŠ¨å¹¶è¿›å…¥å®¹å™¨
eleven@elevendeMacBook-Pro î‚° ~ î‚° docker run -it centos /bin/bash
[root@8db667a7c3db /]# ls
bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var
dev  home  lib64  media       opt  root  sbin  sys  usr

# ä»å®¹å™¨ä¸­æ¨å‡ºåˆ°ä¸»æœº
exit
```

*åˆ—å‡ºæ‰€æœ‰çš„è¿è¡Œå®¹å™¨*

```shell
docker ps å‘½ä»¤
			# åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨
-a		# åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ + å†å²è¿è¡Œè¿‡çš„å®¹å™¨
-n=?  # æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨
-a		# åªæ˜¾ç¤ºå®¹å™¨ç¼–å·
```

*æ¨å‡ºå®¹å™¨*

```shell
exit 					# å®¹å™¨åœæ­¢å¹¶é€€å‡º
crtl + P + Q	# å®¹å™¨ä¸åœæ­¢é€€å‡º
```

 *åˆ é™¤å®¹å™¨*

```shell
docker rm å®¹å™¨id									 # åˆ é™¤æŒ‡å®šå®¹å™¨ï¼Œä¸èƒ½åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨
docker rm -f $(docker ps -aq)  		# åˆ é™¤æ‰€æœ‰å®¹å™¨
docker ps -a -q|xargs docker rm		# åˆ é™¤æ‰€æœ‰å®¹å™¨
```

*å¯åŠ¨ã€åœæ­¢å®¹å™¨*

```shell
docker start å®¹å™¨id
docker restart å®¹å™¨id
docker stop å®¹å™¨id
docker kill å®¹å™¨id
```

## å…¶ä»–å‘½ä»¤

```shell
docker logs æŸ¥çœ‹æ—¥å¿—
docker logs -f -t --tail 10 å®¹å™¨id

# å‚æ•°
-tf 			# æ˜¾ç¤ºå®¹å™¨
--tail number # æ˜¾ç¤ºæ—¥å¿—æ¡æ•°
```

æŸ¥çœ‹å®¹å™¨è¿›ç¨‹ä¿¡æ¯

```shell
docker top å®¹å™¨id
```

*æŸ¥çœ‹é•œåƒå…ƒä¿¡æ¯*

```shell
docker inspect å®¹å™¨id
```

*è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨*

```shell
docker exec -it å®¹å™¨id /bin/bash
docker attach å®¹å™¨id

# åŒºåˆ«
# docker exec è¿›å…¥å®¹å™¨å¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯
# docker attach è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹
```

*ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœº*

```shell
docker cp å®¹å™¨id:/home/test.js /home
```

*Commit é•œåƒ*

```shell
docket commit -m='æäº¤çš„ä¿¡æ¯' -a='ä½œè€…' å®¹å™¨id ç›®æ ‡é•œåƒåç§°ï¼š[Tag]
```

# Docker å¯è§†åŒ– 

# å®¹å™¨æ•°æ®å·

## ä»€ä¹ˆæ˜¯å®¹å™¨æ•°æ®å·

å®¹å™¨ä¹‹é—´éœ€è¦ä¸€ä¸ªæ•°æ®å…±äº«çš„æŠ€æœ¯ï¼Docker å®¹å™¨ä¸­äº§ç”Ÿçš„æ•°æ®ï¼ŒåŒæ­¥åˆ°æœ¬åœ°ï¼ ==æ•°æ®æŒä¹…åŒ–==

æ–‡ä»¶æ“ä½œæ˜¯åŒå‘çš„

*å¥½å¤„*

ä¿®æ”¹æ–‡ä»¶åªéœ€åœ¨æœ¬åœ°ä¿®æ”¹å³å¯ï¼Œå®¹å™¨å†…éƒ¨ä¼šè·Ÿç€æ”¹å˜

```shell
docker run -d -p 3310:3306 -v /home/mysql/conf:etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7

# å‚æ•°
-d åå°è¿è¡Œ
-p ç«¯å£æ˜ å°„
-v æŒ‚è½½æ•°æ®å·
-e ç¯å¢ƒé…ç½®
--name å®¹å™¨åç§°
```

## æŸ¥çœ‹æ•°æ®å·

```shell
docker volume --help

Commands:
  create      Create a volume
  inspect     Display detailed information on one or more volumes
  ls          List volumes
  prune       Remove all unused local volumes
  rm          Remove one or more volumes

```



## å…·åå’ŒåŒ¿åæŒ‚è½½

```shell
# åŒ¿åæŒ‚è½½
-v å®¹å™¨å†…è·¯å¾„ # åªæŒ‡å®šå®¹å™¨å†…è·¯å¾„
docker run -d -p --name nginx -v /etv/nginx nginx

# å…·åæŒ‚è½½
docker run -d -p --name nginx02 -v juming-nginx:/etv/nginx nginx

# æŸ¥çœ‹å·ä¿¡æ¯
docker volume inspect juming-nginx
```

æ‰€æœ‰docker å®¹å™¨å†…çš„å·ï¼Œæ²¡æœ‰æŒ‡å®šç›®å½•çš„æƒ…å†µä¸‹éƒ½æ˜¯åœ¨==/var/lib/docker/volumes/xxx/_data==

é€šè¿‡å…·åæŒ‚è½½å¯ä»¥æ–¹ä¾¿çš„æ‰¾åˆ°ä¸€ä¸ªå·

*åŒºåˆ†å…·åã€åŒ¿åæŒ‚è½½*ã€æŒ‡å®šè·¯å¾„æŒ‚è½½

```shell
-v å®¹å™¨è·¯å¾„								# åŒ¿å
-v å·åï¼šå®¹å™¨å†…è·¯å¾„					# å…·å
-v /å®¿ä¸»è·¯å¾„:/å®¹å™¨å†…è·¯å¾„			# æŒ‡å®šè·¯å¾„
```

*è®¾ç½®æ•°æ®å·æƒé™*

```shell
# é€šè¿‡-v å®¹å™¨å†…è·¯å¾„ï¼šro   rw æ”¹å˜è¯»å†™æƒé™
ro read-only # åªè¯»
rw read-write # è¯»å†™

docker run -d -p --name nginx -v /etv/nginx:ro nginx
docker run -d -p --name nginx -v /etv/nginx:rw nginx

```

*é€šè¿‡dockerfileæŒ‚è½½æ•°æ®å·*

```shell
# åˆ›å»ºä¸€ä¸ªdockerfile æ–‡ä»¶ï¼Œåå­—å¯ä»¥éšæœºï¼Œå»ºè®®ockerfile
# æ–‡ä»¶ä¸­æŒ‡ä»¤éƒ½è¦å¤§å†™
FROM centos

VOLUME 	['volume01', 'volume02']  # åŒ¿åæŒ‚è½½

CMD echo"====end===="

CMD /bin/bash
```

*æ•°æ®å·å®¹å™¨*

å¤šä¸ªå®¹å™¨æ•°æ®å…±äº«ã€åŒæ­¥ã€å¤‡ä»½

```shell
docker run -d -p 3310:3306 -v /home/mysql/conf:etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7

docker run -d -p 3310:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7
```

*ç»“è®º*

å®¹å™¨ä¹‹é—´å¯ä»¥åšé…ç½®ä¹‹é—´çš„ä¼ é€’ï¼Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨ä¸ºæ­¢ã€‚ä½†æ˜¯ä¸€æ—¦æŒä¹…åŒ–åˆ°æœ¬åœ°ï¼Œæœ¬åœ°çš„æ•°æ®æ˜¯ä¸ä¼šåˆ é™¤çš„

# Dockerfile

Dockerfile å°±æ˜¯ç”¨æ¥æ„å»ºdockeré•œåƒçš„æ–‡ä»¶ï¼

é€šè¿‡è„šæœ¬ç”Ÿæˆé•œåƒï¼Œè„šæœ¬å°±æ˜¯ä¸€ä¸ªä¸ªçš„å‘½ä»¤ã€‚

## æ„å»ºæ­¥éª¤

* ç¼–å†™ä¸€ä¸ªdockerfileæ–‡ä»¶
* docker build ç”Ÿæˆä¸€ä¸ªé•œåƒ
* docker run è¿è¡Œé•œåƒ
* docker push å‘å¸ƒé•œåƒ

## Dockerfile æŒ‡ä»¤

```shell
	FROM 											# åŸºç¡€é•œåƒï¼Œä¸€åˆ‡ä»è¿™é‡Œå¼€å§‹
	MAINTAINER								# é•œåƒä½œè€… å§“å+é‚®ç®±
	RUN												# é•œåƒæ„å»ºéœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤
	ADD												# æ­¥éª¤
	WORKDIR										# é•œåƒå·¥ä½œç›®å½•
	VOLUME										# å·æŒ‚è½½ç›®å½•
	EXPOSE										# æš´éœ²ç«¯å£é…ç½®
	CMD												# æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆï¼Œå¯è¢«æ›¿ä»£
	ENTRYPOINT								# æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ å¯è¿½åŠ 
	ONBUILD										# 
	COPY											# ç±»ä¼¼add æ–‡ä»¶æ‹·è´
	ENV												# æ„å»ºæ—¶è®¾ç½®ç¯å¢ƒå˜é‡
```

> åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„centos

```shell
# 1ã€ç¼–å†™Dockerfile æ–‡ä»¶
FROM centos

ENV MYPATH /usr/local
WORKDIR $MYPATH

RUN yum -y install vim 
RUN yum -y install net-tools

EXPOSE 80

CMD echo $MYPATH
CMD echo "====end===="
CMD /bin/bash

# 2ã€æ„å»ºé•œåƒ
# docker build -f dockerfile -t é•œåƒå:[tag] .
```



## å‘å¸ƒé•œåƒ

> DockerHub

```shell
docker login --help

Usage:
  docker login [OPTIONS] [SERVER] [flags]
  docker login [command]

Available Commands:
  azure       Log in to azure

Flags:
  -h, --help              Help for login
  -p, --password string   password
      --password-stdin    Take the password from stdin
  -u, --username string   username
  
# ç™»å½•dockerhub
docker login -u inkkk
Password:
Login Succeeded

# å‘å¸ƒé•œåƒ
docker push inkkk/centos:1.0
The push refers to repository [docker.io/inkkk/centos]
2130a608aed1: Pushed
fd3db5bbc81b: Pushed
5f70bf18a086: Pushed
2653d992f4ef: Mounted from library/centos
1.0: digest: sha256:65567f812ca019fba8e94711eb63c7bba8b283c089011d28b75a654f5e13fbc4 size: 1158

```



## å°ç»“

![æˆªå±2021-01-03 ä¸‹åˆ1.34.01](/Users/eleven/Desktop/æˆªå±2021-01-03 ä¸‹åˆ1.34.01.png)



# Dockerç½‘ç»œ



# Docker Compose

## ç®€ä»‹

Docker Compose å®šä¹‰è¿è¡Œ å¤šä¸ªå®¹å™¨ é€šè¿‡ yamlæ–‡ä»¶é…ç½®

## ä½¿ç”¨Composeçš„ä¸‰ä¸ªæ­¥éª¤

* å®šä¹‰Dockerfile æ–‡ä»¶åˆ¶å®šè¿è¡Œç¯å¢ƒ

* ç”¨è¿‡ docker-compost.ymlæ–‡ä»¶è£…é¥°æœåŠ¡

* docker-compose up å¯åŠ¨æ•´ä¸ªapp

  

Composeé‡è¦æ¦‚å¿µ

* æœåŠ¡service: å®¹å™¨ï¼ˆweb redis mysqlï¼‰
* é¡¹ç›®project ä¸€ç»„å…³è”çš„å®¹å™¨ 

## yml è§„åˆ™

DockerCompose.yaml æ ¸å¿ƒï¼

```shell
# 3å±‚
version: ''		# 1ã€ç‰ˆæœ¬å·
service: 			# 2ã€æœåŠ¡
	æœåŠ¡1ï¼š web
	# æœåŠ¡é…ç½®
	images
	build
	network
	...
	æœåŠ¡2ï¼š redis
	# æœåŠ¡é…ç½®
	...
	æœåŠ¡3ï¼š mysql
	# æœåŠ¡é…ç½®
	...

# å…¶ä»–é…ç½®
volumes
networks
configs

```



# Docker Swarm

# Docker Stack

# Docker Secret

# Docker Config

# K8s

