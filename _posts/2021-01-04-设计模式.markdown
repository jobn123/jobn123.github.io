---
layout:     post
title:      "Javascriptè®¾è®¡æ¨¡å¼"
subtitle:   "ğŸ—"
date:       2021-01-04 12:00:00
author:     "Hiz"
header-img: "img/post-bg-2015.jpg"
catalog: true
tags:
    - è®¾è®¡æ¨¡å¼
    - Javascript
---

# è®¾è®¡æ¨¡å¼

> æ¯ä¸€ä¸ªæ¨¡å¼æè¿°äº†ä¸€ä¸ªåœ¨æˆ‘ä»¬å‘¨å›´ä¸æ–­é‡å¤å‘ç”Ÿçš„é—®é¢˜ï¼Œä»¥åŠè¯¥é—®é¢˜çš„è§£å†³æ–¹æ¡ˆçš„æ ¸å¿ƒã€‚è¿™æ ·ï¼Œä½ å°±èƒ½ä¸€æ¬¡åˆä¸€æ¬¡åœ°ä½¿ç”¨è¯¥æ–¹æ¡ˆè€Œä¸å¿…åšé‡å¤åŠ³åŠ¨ã€‚ â€”â€” Christopher Alexander

## SOLIDè®¾è®¡åŸåˆ™

> "SOLID" æ˜¯ç”±ç½—ä¼¯ç‰¹Â·CÂ·é©¬ä¸åœ¨ 21 ä¸–çºªæ—©æœŸå¼•å…¥çš„è®°å¿†æœ¯é¦–å­—æ¯ç¼©ç•¥å­—ï¼ŒæŒ‡ä»£äº†é¢å‘å¯¹è±¡ç¼–ç¨‹å’Œé¢å‘å¯¹è±¡è®¾è®¡çš„äº”ä¸ªåŸºæœ¬åŸåˆ™

* å•ä¸€åŠŸèƒ½åŸåˆ™ Single Responsibility Principle
* å¼€å‘å°é—­åŸåˆ™ Opened Closed Principle
* é‡Œå¼æ›¿æ¢åŸåˆ™ Liskov Substitution Principle
* æ¥å£éš”ç¦»åŸåˆ™ Interface Segregation Principle
* ä¾èµ–åè½¬åŸåˆ™ Dependency Inversion Principle

## è®¾è®¡æ¨¡å¼æ ¸å¿ƒæ€æƒ³-

*å°è£…å˜åŒ–*

ä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸å‘ç”Ÿå˜åŒ–çš„ä»£ç å¯ä»¥è¯´æ˜¯ä¸å­˜åœ¨çš„ã€‚æˆ‘ä»¬èƒ½åšçš„åªæœ‰å°†è¿™ä¸ªå˜åŒ–é€ æˆçš„å½±å“**æœ€å°åŒ–** â€”â€” **å°†å˜ä¸ä¸å˜åˆ†ç¦»ï¼Œç¡®ä¿å˜åŒ–çš„éƒ¨åˆ†çµæ´»ã€ä¸å˜çš„éƒ¨åˆ†ç¨³å®š**ã€‚

## è®¾è®¡æ¨¡å¼ç±»å‹

<img src="https://gitee.com/inkkk0516/typora/raw/master/pattern-type.png" alt="pattern-type" style="zoom:33%;" />

# æ„é€ æ¨¡å¼

```javascript
function user (name, age, career) {
  this.name = name
  this.age = age
  this.career = career
}

const john = new user('john', 18, 'å‰ç«¯')
const tom = new user('tom', 18, 'åç«¯')
```

åƒ User è¿™æ ·å½“æ–°å»ºå¯¹è±¡çš„å†…å­˜è¢«åˆ†é…åï¼Œç”¨æ¥åˆå§‹åŒ–è¯¥å¯¹è±¡çš„ç‰¹æ®Šå‡½æ•°ï¼Œå°±å«åšæ„é€ å™¨ã€‚åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ„é€ å‡½æ•°å»åˆå§‹åŒ–å¯¹è±¡ï¼Œå°±æ˜¯åº”ç”¨äº†**æ„é€ å™¨æ¨¡å¼**ã€‚

**åœ¨åˆ›å»ºä¸€ä¸ªuserè¿‡ç¨‹ä¸­ï¼Œè°å˜äº†ï¼Œè°ä¸å˜ï¼Ÿ**

å¾ˆæ˜æ˜¾ï¼Œå˜çš„æ˜¯æ¯ä¸ªuserçš„å§“åã€å¹´é¾„ã€å·¥ç§è¿™äº›å€¼ï¼Œè¿™æ˜¯ç”¨æˆ·çš„**ä¸ªæ€§**ï¼Œä¸å˜çš„æ˜¯æ¯ä¸ªå‘˜å·¥éƒ½å…·å¤‡å§“åã€å¹´é¾„ã€å·¥ç§è¿™äº›å±æ€§ï¼Œè¿™æ˜¯ç”¨æˆ·çš„**å…±æ€§**ã€‚

**é‚£ä¹ˆæ„é€ å™¨åšäº†ä»€ä¹ˆï¼Ÿ**

æ„é€ å™¨æ˜¯ä¸æ˜¯å°†å±æ€§èµ‹å€¼ç»™å¯¹è±¡çš„è¿‡ç¨‹å°è£…ï¼Œç¡®ä¿äº†æ¯ä¸ªå¯¹è±¡éƒ½å…·å¤‡è¿™äº›å±æ€§ï¼Œç¡®ä¿äº†**å…±æ€§**çš„ä¸å˜ï¼ŒåŒæ—¶å°† å±æ€§æ“ä½œå¼€æ”¾ï¼Œç¡®ä¿äº†**ä¸ªæ€§**çš„çµæ´»ï¼

# å·¥å‚æ¨¡å¼

å·¥å‚æ¨¡å¼å…¶å®å°±æ˜¯**å°†åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹å•ç‹¬å°è£…**ã€‚

## ç®€å•å·¥å‚æ¨¡å¼

```javascript
function user = (name, age, career, work) {
  this.name = name
  this.age = age
  this.carrer = career
  this.work = work
}

function Factory = (name, age, career) {
  let work
  
  switch (career) {
    case 'coder':
      work = ['code', 'bug']
      break
    case 'tester': 
      work = ['test']
      break
    case: 'boss'
      work = ['read paper', 'tea']
      break
    ....
  }
  
  return new user(name, age, career, work)
}
```

å·¥å‚æ¨¡å¼çš„ç›®çš„ï¼Œå°±æ˜¯ä¸ºäº†å®ç°**æ— è„‘ä¼ å‚**

##  æŠ½è±¡å·¥å‚æ¨¡å¼--å¼€æ”¾å°é—­åŸåˆ™

**æŠ½è±¡å·¥å‚ä¸å¹²æ´»ï¼Œåªæš´éœ²æ¥å£ï¼Œå…·ä½“å·¥å‚ï¼ˆConcreteFactoryï¼‰æ¥å¹²æ´»**

==æŠ½è±¡å·¥å‚æ¥å£æš´éœ²æ¥å£==

```javascript
// æŠ½è±¡å·¥å‚æš´éœ²æ¥å£

class MobilePhoneFactory {
  // æ“ä½œç³»ç»Ÿæ¥å£
  createOS () {
    throw new Error('æŠ½è±¡å·¥å‚ä¸å…è®¸ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é‡å†™')
  }
  // ç¡¬ä»¶æ¥å£
  createHardware () {
    throw new Error('æŠ½è±¡å·¥å‚ä¸å…è®¸ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é‡å†™')
  }
}

// æ“ä½œç³»ç»ŸæŠ½è±¡ç±»
class OS {
  controlHardWare() {
    throw new Error('æŠ½è±¡äº§å“æ–¹æ³•ä¸å…è®¸ç›´æ¥è°ƒç”¨ï¼Œä½ éœ€è¦å°†æˆ‘é‡å†™ï¼');
  }
}

// å®šä¹‰æ‰‹æœºç¡¬ä»¶è¿™ç±»äº§å“çš„æŠ½è±¡äº§å“ç±»
class HardWare {
  // æ‰‹æœºç¡¬ä»¶çš„å…±æ€§æ–¹æ³•ï¼Œè¿™é‡Œæå–äº†â€œæ ¹æ®å‘½ä»¤è¿è½¬â€è¿™ä¸ªå…±æ€§
  operateByOrder() {
    throw new Error('æŠ½è±¡äº§å“æ–¹æ³•ä¸å…è®¸ç›´æ¥è°ƒç”¨ï¼Œä½ éœ€è¦å°†æˆ‘é‡å†™ï¼');
  }
}
```

==å…·ä½“å·¥å‚ç»§æ‰¿æŠ½è±¡å·¥å‚å¹¶å®ç°æ¥å£==

```javascript
class FakestarFactory extends MobilePhoneFactory {
  createOS () {
    return new AndroidOS()
  }
  
  createHardware () {
    return new QualcommHardWare()
  }
}

// å®šä¹‰å…·ä½“æ“ä½œç³»ç»Ÿçš„å…·ä½“äº§å“ç±»
class AndroidOS extends OS {
  controlHardWare() {
    console.log('æˆ‘ä¼šç”¨å®‰å“çš„æ–¹å¼å»æ“ä½œç¡¬ä»¶')
  }
}

class AppleOS extends OS {
  controlHardWare() {
    console.log('æˆ‘ä¼šç”¨è‹¹æœçš„æ–¹å¼å»æ“ä½œç¡¬ä»¶')
  }
}

// å®šä¹‰å…·ä½“ç¡¬ä»¶çš„å…·ä½“äº§å“ç±»
class QualcommHardWare extends HardWare {
  operateByOrder() {
    console.log('æˆ‘ä¼šç”¨é«˜é€šçš„æ–¹å¼å»è¿è½¬')
  }
}

class MiWare extends HardWare {
  operateByOrder() {
    console.log('æˆ‘ä¼šç”¨å°ç±³çš„æ–¹å¼å»è¿è½¬')
  }
}
```

==æœ€åå®ç°==

```javascript
// åˆ›å»ºæ‰‹æœº
const myPhone = new FakeStarFactory()
// æ‹¥æœ‰æ“ä½œç³»ç»Ÿ
const myOS = myPhone.createOS()
// æ‹¥æœ‰ç¡¬ä»¶
const myHardWare = myPhone.createHardWare()
// å¯åŠ¨æ“ä½œç³»ç»Ÿ(è¾“å‡ºâ€˜æˆ‘ä¼šç”¨å®‰å“çš„æ–¹å¼å»æ“ä½œç¡¬ä»¶â€™)
myOS.controlHardWare()
// å”¤é†’ç¡¬ä»¶(è¾“å‡ºâ€˜æˆ‘ä¼šç”¨é«˜é€šçš„æ–¹å¼å»è¿è½¬â€™)
myHardWare.operateByOrder()
```

å‡å¦‚æœ‰ä¸€å¤©ï¼ŒFakeStarè¿‡æ°”äº†ï¼Œæˆ‘ä»¬éœ€è¦äº§å‡ºä¸€æ¬¾æ–°æœºæŠ•å…¥å¸‚åœºï¼Œè¿™æ—¶å€™æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯**ä¸éœ€è¦å¯¹æŠ½è±¡å·¥å‚MobilePhoneFactoryåšä»»ä½•ä¿®æ”¹**ï¼Œåªéœ€è¦æ‹“å±•å®ƒçš„ç§ç±»

è¿™ä¹ˆä¸ªæ“ä½œï¼Œ**å¯¹åŸæœ‰çš„ç³»ç»Ÿä¸ä¼šé€ æˆä»»ä½•æ½œåœ¨å½±å“** æ‰€è°“çš„â€œå¯¹æ‹“å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­â€å°±è¿™ä¹ˆåœ†æ»¡å®ç°äº†ã€‚å‰é¢æˆ‘ä»¬ä¹‹æ‰€ä»¥è¦å®ç°**æŠ½è±¡äº§å“ç±»**ï¼Œä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚

## æ€»ç»“

æŠ½è±¡å·¥å‚å’Œç®€å•å·¥å‚å®ƒä»¬çš„å…±åŒç‚¹ï¼Œåœ¨äºéƒ½**å°è¯•å»åˆ†ç¦»ä¸€ä¸ªç³»ç»Ÿä¸­å˜ä¸ä¸å˜çš„éƒ¨åˆ†**ã€‚å®ƒä»¬çš„ä¸åŒåœ¨äº**åœºæ™¯çš„å¤æ‚åº¦**ã€‚

æŠ½è±¡å·¥å‚æ¨¡å¼çš„å®šä¹‰ï¼Œæ˜¯**å›´ç»•ä¸€ä¸ªè¶…çº§å·¥å‚åˆ›å»ºå…¶ä»–å·¥å‚**

# å•ä¾‹æ¨¡å¼

**ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹**ï¼Œè¿™æ ·çš„æ¨¡å¼å°±å«åšå•ä¾‹æ¨¡å¼ã€‚

è€Œå•ä¾‹æ¨¡å¼æƒ³è¦åšåˆ°çš„æ˜¯ï¼Œ**ä¸ç®¡æˆ‘ä»¬å»åˆ›å»ºå¤šå°‘æ¬¡ï¼Œå®ƒéƒ½åªç»™ä½ è¿”å›ç¬¬ä¸€æ¬¡æ‰€åˆ›å»ºçš„é‚£å”¯ä¸€çš„ä¸€ä¸ªå®ä¾‹**ã€‚

```javascript
// 1ã€class å®ç°æ–¹å¼

class SingleDog {
  show() {
    console.log('æˆ‘æ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡')
  }
  static getInstance() {
    // åˆ¤æ–­æ˜¯å¦å·²ç»newè¿‡1ä¸ªå®ä¾‹
    if (!SingleDog.instance) {
      // è‹¥è¿™ä¸ªå”¯ä¸€çš„å®ä¾‹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå…ˆåˆ›å»ºå®ƒ
      SingleDog.instance = new SingleDog()
    }
    // å¦‚æœè¿™ä¸ªå”¯ä¸€çš„å®ä¾‹å·²ç»å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›
    return SingleDog.instance
  }
}

const s1 = SingleDog.getInstance()
const s2 = SingleDog.getInstance()

// true
s1 === s2

// 2ã€é—­åŒ…å®ç°æ–¹å¼
SingleDog.getInstance = (function() {
    // å®šä¹‰è‡ªç”±å˜é‡instanceï¼Œæ¨¡æ‹Ÿç§æœ‰å˜é‡
    let instance = null
    return function() {
        // åˆ¤æ–­è‡ªç”±å˜é‡æ˜¯å¦ä¸ºnull
        if(!instance) {
            // å¦‚æœä¸ºnullåˆ™newå‡ºå”¯ä¸€å®ä¾‹
            instance = new SingleDog()
        }
        return instance
    }
})()
```

## ä¾‹å­1ã€å®ç°ä¸€ä¸ªstorage

> å®ç°Storageï¼Œä½¿å¾—è¯¥å¯¹è±¡ä¸ºå•ä¾‹ï¼ŒåŸºäº localStorage è¿›è¡Œå°è£…ã€‚å®ç°æ–¹æ³• setItem(key,value) å’Œ getItem(key)ã€‚

```javascript
// å®šä¹‰Storage
class Storage {
    static getInstance() {
        // åˆ¤æ–­æ˜¯å¦å·²ç»newè¿‡1ä¸ªå®ä¾‹
        if (!Storage.instance) {
            // è‹¥è¿™ä¸ªå”¯ä¸€çš„å®ä¾‹ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå…ˆåˆ›å»ºå®ƒ
            Storage.instance = new Storage()
        }
        // å¦‚æœè¿™ä¸ªå”¯ä¸€çš„å®ä¾‹å·²ç»å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›
        return Storage.instance
    }
    getItem (key) {
        return localStorage.getItem(key)
    }
    setItem (key, value) {
        return localStorage.setItem(key, value)
    }
}

const storage1 = Storage.getInstance()
const storage2 = Storage.getInstance()

storage1.setItem('name', 'æé›·')
// æé›·
storage1.getItem('name')
// ä¹Ÿæ˜¯æé›·
storage2.getItem('name')

// è¿”å›true
storage1 === storage2
```

## ä¾‹å­2ã€å®ç°ä¸€ä¸ªå…¨å±€çš„æ¨¡æ€æ¡†

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>å•ä¾‹æ¨¡å¼å¼¹æ¡†</title>
</head>
<style>
    #modal {
        height: 200px;
        width: 200px;
        line-height: 200px;
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        border: 1px solid black;
        text-align: center;
    }
</style>
<body>
	<button id='open'>æ‰“å¼€å¼¹æ¡†</button>
	<button id='close'>å…³é—­å¼¹æ¡†</button>
</body>
<script>
    // æ ¸å¿ƒé€»è¾‘ï¼Œè¿™é‡Œé‡‡ç”¨äº†é—­åŒ…æ€è·¯æ¥å®ç°å•ä¾‹æ¨¡å¼
    const Modal = (function() {
    	let modal = null
    	return function() {
        if(!modal) {
          modal = document.createElement('div')
          modal.innerHTML = 'æˆ‘æ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„Modal'
          modal.id = 'modal'
          modal.style.display = 'none'
          document.body.appendChild(modal)
        }
        return modal
    	}
    })()
    
    // ç‚¹å‡»æ‰“å¼€æŒ‰é’®å±•ç¤ºæ¨¡æ€æ¡†
    document.getElementById('open').addEventListener('click', function() {
        // æœªç‚¹å‡»åˆ™ä¸åˆ›å»ºmodalå®ä¾‹ï¼Œé¿å…ä¸å¿…è¦çš„å†…å­˜å ç”¨;æ­¤å¤„ä¸ç”¨ new Modal çš„å½¢å¼è°ƒç”¨ä¹Ÿå¯ä»¥
    	const modal = new Modal()
    	modal.style.display = 'block'
    })
    
    // ç‚¹å‡»å…³é—­æŒ‰é’®éšè—æ¨¡æ€æ¡†
    document.getElementById('close').addEventListener('click', function() {
    	const modal = new Modal()
    	if(modal) {
    	    modal.style.display = 'none'
    	}
    })
</script>
</html>
```

# åŸå‹æ¨¡å¼

åŸå‹æ¨¡å¼ä¸ä»…æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒè¿˜æ˜¯ä¸€ç§**ç¼–ç¨‹èŒƒå¼**ï¼ˆprogramming paradigmï¼‰ï¼Œæ˜¯ JavaScript é¢å‘å¯¹è±¡ç³»ç»Ÿå®ç°çš„æ ¹åŸºã€‚

åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åŸå‹æ¨¡å¼ï¼Œå¹¶ä¸æ˜¯ä¸ºäº†å¾—åˆ°ä¸€ä¸ªå‰¯æœ¬ï¼Œè€Œæ˜¯ä¸ºäº†å¾—åˆ°ä¸æ„é€ å‡½æ•°ï¼ˆç±»ï¼‰ç›¸å¯¹åº”çš„ç±»å‹çš„å®ä¾‹ã€å®ç°æ•°æ®/æ–¹æ³•çš„å…±äº«ã€‚å…‹éš†æ˜¯å®ç°è¿™ä¸ªç›®çš„çš„æ–¹æ³•ï¼Œä½†å…‹éš†æœ¬èº«å¹¶ä¸æ˜¯æˆ‘ä»¬çš„ç›®çš„ã€‚

## JavaScript ä¸­çš„â€œç±»â€

==ES6 çš„ç±»å…¶å®æ˜¯åŸå‹ç»§æ‰¿çš„è¯­æ³•ç³–:==

> ECMAScript 2015 ä¸­å¼•å…¥çš„ JavaScript ç±»å®è´¨ä¸Šæ˜¯ JavaScript ç°æœ‰çš„åŸºäºåŸå‹çš„ç»§æ‰¿çš„è¯­æ³•ç³–ã€‚ç±»è¯­æ³•ä¸ä¼šä¸º JavaScript å¼•å…¥æ–°çš„é¢å‘å¯¹è±¡çš„ç»§æ‰¿æ¨¡å‹ã€‚ â€”â€”MDN

å½“æˆ‘ä»¬å°è¯•ç”¨ class å»å®šä¹‰ä¸€ä¸ª Dog ç±»æ—¶ï¼š

```javascript
class Dog {
  constructor(name ,age) {
   this.name = name
   this.age = age
  }
  
  eat() {
    console.log('è‚‰éª¨å¤´çœŸå¥½åƒ')
  }
}
```

å…¶å®å®Œå…¨ç­‰ä»·äºå†™äº†è¿™ä¹ˆä¸€ä¸ªæ„é€ å‡½æ•°:

```javascript
function Dog(name, age) {
  this.name = name
  this.age = age
}

Dog.prototype.eat = function() {
  console.log('è‚‰éª¨å¤´çœŸå¥½åƒ')
}
```

## è°ˆåŸå‹æ¨¡å¼ï¼Œå…¶å®æ˜¯è°ˆåŸå‹èŒƒå¼

åŸå‹ç¼–ç¨‹èŒƒå¼çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯**åˆ©ç”¨å®ä¾‹æ¥æè¿°å¯¹è±¡ï¼Œç”¨å®ä¾‹ä½œä¸ºå®šä¹‰å¯¹è±¡å’Œç»§æ‰¿çš„åŸºç¡€**ã€‚åœ¨ JavaScript ä¸­ï¼ŒåŸå‹ç¼–ç¨‹èŒƒå¼çš„ä½“ç°å°±æ˜¯**åŸºäºåŸå‹é“¾çš„ç»§æ‰¿**ã€‚è¿™å…¶ä¸­ï¼Œå¯¹åŸå‹ã€åŸå‹é“¾çš„ç†è§£æ˜¯å…³é”®ã€‚

### åŸå‹

åœ¨ JavaScript ä¸­ï¼Œæ¯ä¸ªæ„é€ å‡½æ•°éƒ½æ‹¥æœ‰ä¸€ä¸ª`prototype`å±æ€§ï¼Œå®ƒæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œè¿™ä¸ªåŸå‹å¯¹è±¡ä¸­æœ‰ä¸€ä¸ª constructor å±æ€§æŒ‡å›æ„é€ å‡½æ•°ï¼›æ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ª`__proto__`å±æ€§ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨æ„é€ å‡½æ•°å»åˆ›å»ºå®ä¾‹æ—¶ï¼Œå®ä¾‹çš„`__proto__`å±æ€§å°±ä¼šæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚

```javascript
// åˆ›å»ºä¸€ä¸ªDogæ„é€ å‡½æ•°
function Dog(name, age) {
  this.name = name
  this.age = age
}

Dog.prototype.eat = function() {
  console.log('è‚‰éª¨å¤´çœŸå¥½åƒ')
}

// ä½¿ç”¨Dogæ„é€ å‡½æ•°åˆ›å»ºdogå®ä¾‹
const dog = new Dog('æ—ºè´¢', 3)

dog.__proto__
{eat: Æ’, constructor: Æ’}

dog.__proto__ === Dog.prototype // true

Dog.prototype.constructor.name === 'Dog'
dog.constructor.name === 'Dog'
```

### åŸå‹é“¾

```javascript
// è¾“å‡º"è‚‰éª¨å¤´çœŸå¥½åƒ"
dog.eat()
// è¾“å‡º"[object Object]"
dog.toString(
```

<img src="https://gitee.com/inkkk0516/typora/raw/master/prototype.png" alt="prototype" style="zoom:50%;" />

### å¯¹è±¡çš„æ·±æ‹·è´

æµ…æ‹·è´å°±æ˜¯åªè¿›è¡Œä¸€å±‚æ‹·è´ï¼Œæ·±æ‹·è´å°±æ˜¯æ— é™å±‚çº§æ‹·è´

#### JSON.stringify()

```javascript
const liLei = {
    name: 'lilei',
    age: 28,
    habits: ['coding', 'hiking', 'running']
}

const liLeiStr = JSON.stringify(liLei)
const liLeiCopy = JSON.parse(liLeiStr)
liLeiCopy.habits.splice(0, 1) 
console.log('æé›·å‰¯æœ¬çš„habitsæ•°ç»„æ˜¯', liLeiCopy.habits)
console.log('æé›·çš„habitsæ•°ç»„æ˜¯',  liLei.habits)
```

*å±€é™æ€§*

åªèƒ½æ‰§è¡Œä¸¥æ ¼çš„JSONå¯¹è±¡ï¼Œæ— æ³•å¤„ç†functionã€æ­£åˆ™ç­‰ç‰¹æ®Šæƒ…å†µ

#### é€’å½’å®ç°

```javascript
function deepClone(obj) {
    // å¦‚æœæ˜¯ å€¼ç±»å‹ æˆ– nullï¼Œåˆ™ç›´æ¥return
    if(typeof obj !== 'object' || obj === null) {
        return obj
    }
    
    // å®šä¹‰ç»“æœå¯¹è±¡
    let copy = {}
    
    // å¦‚æœå¯¹è±¡æ˜¯æ•°ç»„ï¼Œåˆ™å®šä¹‰ç»“æœæ•°ç»„
    if(obj.constructor === Array) {
        copy = []
    }
    
    // éå†å¯¹è±¡çš„key
    for(let key in obj) {
        // å¦‚æœkeyæ˜¯å¯¹è±¡çš„è‡ªæœ‰å±æ€§
        if(obj.hasOwnProperty(key)) {
            // é€’å½’è°ƒç”¨æ·±æ‹·è´æ–¹æ³•
            copy[key] = deepClone(obj[key])
        }
    }
    
    return copy
} 
```

[æ·±æ‹·è´ç»ˆææ¢ç´¢](https://segmentfault.com/a/1190000016672263)

# è£…é¥°å™¨æ¨¡å¼

> â€œåœ¨ä¸æ”¹å˜åŸå¯¹è±¡çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å¯¹å…¶è¿›è¡ŒåŒ…è£…æ‹“å±•ï¼Œä½¿åŸæœ‰å¯¹è±¡å¯ä»¥æ»¡è¶³ç”¨æˆ·çš„æ›´å¤æ‚éœ€æ±‚â€ã€‚

ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯ï¼š

- ä¸ºå¯¹è±¡æ·»åŠ æ–°åŠŸèƒ½
- ä¸æ”¹å˜å…¶åŸæœ‰çš„ç»“æ„å’ŒåŠŸèƒ½

```javascript
class Circle {
    draw(){
        console.log("ç”»ä¸€ä¸ªåœ†å½¢");
    }
}

class Decorator {
    constructor(circle){
        this.circle = circle;
    }

    draw(circle){
        this.circle.draw();
        this.setRedBorder(circle);
    }

    setRedBorder(circle){
        console.log("è®¾ç½®çº¢è‰²è¾¹æ¡†");
    }
}

//æµ‹è¯•ä»£ç 
let circle = new Circle();
circle.draw(); //ç”»äº†ä¸€ä¸ªåœ†å½¢

//è£…é¥°å™¨çš„ä½œç”¨
let decorator = new Decorator();
decorator.draw(circle); //ç”»äº†ä¸€ä¸ªåœ†å½¢ï¼Œå¹¶è®¾ç½®äº†çº¢è‰²è¾¹æ¡†
```

## ES7ä¸­çš„è£…é¥°å™¨

### ç±»è£…é¥°å™¨

```javascript
// è£…é¥°å™¨å‡½æ•°ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç›®æ ‡ç±»
function classDecorator(target) {
  	// æ­¤å¤„çš„ target å°±æ˜¯è¢«è£…é¥°çš„ç±»æœ¬èº«ã€‚
    target.hasDecorator = true
  	return target
}

// å°†è£…é¥°å™¨â€œå®‰è£…â€åˆ°Buttonç±»ä¸Š
@classDecorator
class Button {
    // Buttonç±»çš„ç›¸å…³é€»è¾‘
}

// éªŒè¯è£…é¥°å™¨æ˜¯å¦ç”Ÿæ•ˆ
console.log('Button æ˜¯å¦è¢«è£…é¥°äº†ï¼š', Button.hasDecorator)
```

### æ–¹æ³•è£…é¥°å™¨

```javascript
/**
*	targetæ˜¯Button.prototype
* nameæ˜¯æˆ‘ä»¬ä¿®é¥°çš„ç›®æ ‡å±æ€§å±æ€§å
* descriptorï¼šå±æ€§æè¿°å¯¹è±¡â€ï¼ˆattributes objectï¼‰
*/
function funcDecorator(target, name, descriptor) {
  let originalMethod = descriptor.value
  descriptor.value = function() {
    console.log('æˆ‘æ˜¯Funcçš„è£…é¥°å™¨é€»è¾‘')
    return originalMethod.apply(this, arguments)
  }
  return descriptor
}

class Button {
    @funcDecorator
    onClick() { 
        console.log('æˆ‘æ˜¯Funcçš„åŸæœ‰é€»è¾‘')
    }
}

// éªŒè¯è£…é¥°å™¨æ˜¯å¦ç”Ÿæ•ˆ
const button = new Button()
button.onClick()
```

## ç”Ÿäº§å®æˆ˜

### React Hoc

> é«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸”è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªç»„ä»¶ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚

```javascript
import React, { Component } from 'react'

const BorderHoc = WrappedComponent => class extends Component {
  render() {
    return <div style={{ border: 'solid 1px red' }}>
      <WrappedComponent />
    </div>
  }
}
export default borderHoc

//import React, { Component } from 'react'
//import BorderHoc from './BorderHoc'

// ç”¨BorderHocè£…é¥°ç›®æ ‡ç»„ä»¶
@BorderHoc 
class TargetComponent extends React.Component {
  render() {
    // ç›®æ ‡ç»„ä»¶å…·ä½“çš„ä¸šåŠ¡é€»è¾‘
  }
}

// exportå‡ºå»çš„å…¶å®æ˜¯ä¸€ä¸ªè¢«åŒ…è£¹åçš„ç»„ä»¶
export default TargetComponent
```

### ä½¿ç”¨è£…é¥°å™¨æ”¹å†™ Redux connect

redux  connect çš„ä¸¤ä¸ªå…¥å‚ï¼š`mapStateToProps` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥å»ºç«‹ç»„ä»¶å’ŒçŠ¶æ€ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼›`mapDispatchToProps`ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒç”¨äºå»ºç«‹ç»„ä»¶å’Œ`store.dispatch`çš„å…³ç³»ï¼Œä½¿ç»„ä»¶å…·å¤‡é€šè¿‡ dispatch æ¥æ´¾å‘çŠ¶æ€çš„èƒ½åŠ›ã€‚

æŠŠ connect æŠ½å‡ºæ¥ï¼š

```javascript
import { connect } from 'react-redux'
import { bindActionCreators } from 'redux'
import action from './action.js'

function mapStateToProps(state) {
  return state.app
}

function mapDispatchToProps(dispatch) {
  return bindActionCreators(action, dispatch)
}

// å°†connectè°ƒç”¨åçš„ç»“æœä½œä¸ºä¸€ä¸ªè£…é¥°å™¨å¯¼å‡º
export default connect(mapStateToProps, mapDispatchToProps)
```

åœ¨ç»„ä»¶æ–‡ä»¶é‡Œå¼•å…¥connectï¼š

```javascript
import React, { Component } from 'react'
import connect from './connect.js'   

@connect
export default class App extends Component {
  render() {
    // Appçš„ä¸šåŠ¡é€»è¾‘
  }
}
```



### ä¼˜è´¨æºç é˜…è¯»

[core-decorators](https://github.com/jayphelps/core-decorators)

# é€‚é…å™¨æ¨¡å¼

é€‚é…å™¨æ¨¡å¼é€šè¿‡**æŠŠä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æ¥å£**ï¼Œå¯ä»¥å¸®æˆ‘ä»¬è§£å†³**ä¸å…¼å®¹**çš„é—®é¢˜ã€‚

```javascript
function getDefaultAdapter() {
  var adapter;
  // åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯nodeç¯å¢ƒ
  if (typeof process !== 'undefined' && Object.prototype.toString.call(process) === '[object process]') {
    // å¦‚æœæ˜¯nodeç¯å¢ƒï¼Œè°ƒç”¨nodeä¸“å±çš„httpé€‚é…å™¨
    adapter = require('./adapters/http');
  } else if (typeof XMLHttpRequest !== 'undefined') {
    // å¦‚æœæ˜¯æµè§ˆå™¨ç¯å¢ƒï¼Œè°ƒç”¨åŸºäºxhrçš„é€‚é…å™¨
    adapter = require('./adapters/xhr');
  }
  return adapter;
}


// http é€‚é…å™¨ï¼š
module.exports = function httpAdapter(config) {
  return new Promise(function dispatchHttpRequest(resolvePromise, rejectPromise) {
    // å…·ä½“é€»è¾‘
  }
}
                     
// xhr é€‚é…å™¨ï¼š
module.exports = function xhrAdapter(config) {
  return new Promise(function dispatchXhrRequest(resolve, reject) {
    // å…·ä½“é€»è¾‘
  }
}                     
```

# ä»£ç†æ¨¡å¼

ä¸€ä¸ªå¯¹è±¡**ä¸èƒ½ç›´æ¥è®¿é—®**å¦ä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦ä¸€ä¸ª**ç¬¬ä¸‰è€…**ï¼ˆä»£ç†ï¼‰ç‰µçº¿æ­æ¡¥ä»è€Œé—´æ¥è¾¾åˆ°è®¿é—®ç›®çš„ï¼Œè¿™æ ·çš„æ¨¡å¼å°±æ˜¯ä»£ç†æ¨¡å¼ã€‚

## ç§‘å­¦ä¸Šç½‘

*æ­£å¸¸çš„ä¸Šç½‘æµç¨‹*

![å±å¹•å¿«ç…§ 2021-01-09 ä¸‹åˆ3.38.10](https://gitee.com/inkkk0516/typora/raw/master/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202021-01-09%20%E4%B8%8B%E5%8D%883.38.10.png)

*ä½¿ç”¨vpn*

![å±å¹•å¿«ç…§ 2021-01-09 ä¸‹åˆ3.39.35](https://gitee.com/inkkk0516/typora/raw/master/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202021-01-09%20%E4%B8%8B%E5%8D%883.39.35.png)

## ES6 Proxy

<img src="https://gitee.com/inkkk0516/typora/raw/master/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202021-01-09%20%E4%B8%8B%E5%8D%884.00.11.png" alt="å±å¹•å¿«ç…§ 2021-01-09 ä¸‹åˆ4.00.11" style="zoom:33%;" />

```javascript
const proxy = new Proxy(obj, handler)
// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬çš„ç›®æ ‡å¯¹è±¡ï¼Œhandler ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å®šä¹‰ä»£ç†çš„è¡Œä¸ºï¼Œå½“æˆ‘ä»¬é€šè¿‡ proxy å»è®¿é—®ç›®æ ‡å¯¹è±¡çš„æ—¶å€™ï¼Œhandlerä¼šå¯¹æˆ‘ä»¬çš„è¡Œä¸ºä½œä¸€å±‚æ‹¦æˆªï¼Œæˆ‘ä»¬çš„æ¯æ¬¡è®¿é—®éƒ½éœ€è¦ç»è¿‡ handler è¿™ä¸ªç¬¬ä¸‰æ–¹
```

## äº‹ä»¶ä»£ç†

çˆ¶èŠ‚ç‚¹ ä»£ç†å­èŠ‚ç‚¹

ç”¨ä»£ç†æ¨¡å¼å®ç°å¤šä¸ªå­å…ƒç´ çš„äº‹ä»¶ç›‘å¬

```javascript
// è·å–çˆ¶å…ƒç´ 
const father = document.getElementById('father')

// ç»™çˆ¶å…ƒç´ å®‰è£…ä¸€æ¬¡ç›‘å¬å‡½æ•°
father.addEventListener('click', function(e) {
    // è¯†åˆ«æ˜¯å¦æ˜¯ç›®æ ‡å­å…ƒç´ 
    if(e.target.tagName === 'A') {
        // ä»¥ä¸‹æ˜¯ç›‘å¬å‡½æ•°çš„å‡½æ•°ä½“
        e.preventDefault()
        alert(`æˆ‘æ˜¯${e.target.innerText}`)
    }
} )
```

## è™šæ‹Ÿä»£ç†

**å›¾ç‰‡æ‡’åŠ è½½**

åœ¨ä¸€äº›å›¾ç‰‡é‡æ¯”è¾ƒå¤§çš„ç½‘ç«™ï¼Œæ¯”å¦‚ç”µå•†ç½‘ç«™é¦–é¡µï¼Œæˆ–è€…å›¢è´­ç½‘ç«™ã€å°æ¸¸æˆé¦–é¡µç­‰ã€‚å¦‚æœæˆ‘ä»¬å°è¯•åœ¨ç”¨æˆ·æ‰“å¼€é¡µé¢çš„æ—¶å€™ï¼Œå°±æŠŠæ‰€æœ‰çš„å›¾ç‰‡èµ„æºåŠ è½½å®Œæ¯•ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½ä¼šé€ æˆç™½å±ã€å¡é¡¿ç­‰ç°è±¡ã€‚

æ­¤æ—¶æˆ‘ä»¬ä¼šé‡‡å–â€œå…ˆå ä½ã€ååŠ è½½â€çš„æ–¹å¼æ¥å±•ç¤ºå›¾ç‰‡ â€”â€” åœ¨å…ƒç´ éœ²å‡ºä¹‹å‰ï¼Œæˆ‘ä»¬ç»™å®ƒä¸€ä¸ª div ä½œå ä½ï¼Œå½“å®ƒæ»šåŠ¨åˆ°å¯è§†åŒºåŸŸå†…æ—¶ï¼Œå†å³æ—¶åœ°å»åŠ è½½çœŸå®çš„å›¾ç‰‡èµ„æºï¼Œè¿™æ ·åš

**å›¾ç‰‡é¢„åŠ è½½**

é¢„åŠ è½½ä¸»è¦æ˜¯ä¸ºäº†é¿å…ç½‘ç»œä¸å¥½ã€æˆ–è€…å›¾ç‰‡å¤ªå¤§æ—¶ï¼Œé¡µé¢é•¿æ—¶é—´ç»™ç”¨æˆ·ç•™ç™½çš„å°´å°¬ã€‚å¸¸è§çš„æ“ä½œæ˜¯å…ˆè®©è¿™ä¸ª img æ ‡ç­¾å±•ç¤ºä¸€ä¸ªå ä½å›¾ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª Image å®ä¾‹ï¼Œè®©è¿™ä¸ª Image å®ä¾‹çš„ src æŒ‡å‘çœŸå®çš„ç›®æ ‡å›¾ç‰‡åœ°å€ã€è§‚å¯Ÿè¯¥ Image å®ä¾‹çš„åŠ è½½æƒ…å†µ â€”â€” å½“å…¶å¯¹åº”çš„çœŸå®å›¾ç‰‡åŠ è½½å®Œæ¯•åï¼Œå³å·²ç»æœ‰äº†è¯¥å›¾ç‰‡çš„ç¼“å­˜å†…å®¹ï¼Œå†å°† DOM ä¸Šçš„ img å…ƒç´ çš„ src æŒ‡å‘çœŸå®çš„ç›®æ ‡å›¾ç‰‡åœ°å€ã€‚

```javascript
class PreLoadImage {
    constructor(imgNode) {
        // è·å–çœŸå®çš„DOMèŠ‚ç‚¹
        this.imgNode = imgNode
    }
     
    // æ“ä½œimgèŠ‚ç‚¹çš„srcå±æ€§
    setSrc(imgUrl) {
        this.imgNode.src = imgUrl
    }
}

class ProxyImage {
    // å ä½å›¾çš„urlåœ°å€
    static LOADING_URL = 'xxxxxx'

    constructor(targetImage) {
        // ç›®æ ‡Imageï¼Œå³PreLoadImageå®ä¾‹
        this.targetImage = targetImage
    }
    
    // è¯¥æ–¹æ³•ä¸»è¦æ“ä½œè™šæ‹ŸImageï¼Œå®ŒæˆåŠ è½½
    setSrc(targetUrl) {
       // çœŸå®imgèŠ‚ç‚¹åˆå§‹åŒ–æ—¶å±•ç¤ºçš„æ˜¯ä¸€ä¸ªå ä½å›¾
        this.targetImage.setSrc(ProxyImage.LOADING_URL)
        // åˆ›å»ºä¸€ä¸ªå¸®æˆ‘ä»¬åŠ è½½å›¾ç‰‡çš„è™šæ‹ŸImageå®ä¾‹
        const virtualImage = new Image()
        // ç›‘å¬ç›®æ ‡å›¾ç‰‡åŠ è½½çš„æƒ…å†µï¼Œå®Œæˆæ—¶å†å°†DOMä¸Šçš„çœŸå®imgèŠ‚ç‚¹çš„srcå±æ€§è®¾ç½®ä¸ºç›®æ ‡å›¾ç‰‡çš„url
        virtualImage.onload = () => {
            this.targetImage.setSrc(targetUrl)
        }
        // è®¾ç½®srcå±æ€§ï¼Œè™šæ‹ŸImageå®ä¾‹å¼€å§‹åŠ è½½å›¾ç‰‡
        virtualImage.src = targetUrl
    }
}

new ProxyImage(new PreLoadImage(document.getElementById('xxx')))
```



## ç¼“å­˜ä»£ç†

ç¼“å­˜ä»£ç†åº”ç”¨äºä¸€äº›è®¡ç®—é‡è¾ƒå¤§çš„åœºæ™¯é‡Œã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦â€œç”¨ç©ºé—´æ¢æ—¶é—´â€â€”â€”å½“æˆ‘ä»¬éœ€è¦ç”¨åˆ°æŸä¸ªå·²ç»è®¡ç®—è¿‡çš„å€¼çš„æ—¶å€™ï¼Œä¸æƒ³å†è€—æ—¶è¿›è¡ŒäºŒæ¬¡è®¡ç®—ï¼Œè€Œæ˜¯å¸Œæœ›èƒ½ä»å†…å­˜é‡Œå»å–å‡ºç°æˆçš„è®¡ç®—ç»“æœã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œå°±éœ€è¦ä¸€ä¸ªä»£ç†æ¥å¸®æˆ‘ä»¬åœ¨è¿›è¡Œè®¡ç®—çš„åŒæ—¶ï¼Œè¿›è¡Œè®¡ç®—ç»“æœçš„ç¼“å­˜äº†ã€‚

```javascript
// addAllæ–¹æ³•ä¼šå¯¹ä½ ä¼ å…¥çš„æ‰€æœ‰å‚æ•°åšæ±‚å’Œæ“ä½œ
const addAll = function() {
    console.log('è¿›è¡Œäº†ä¸€æ¬¡æ–°è®¡ç®—')
    let result = 0
    const len = arguments.length
    
    for(let i = 0; i < len; i++) {
        result += arguments[i]
    }
    return result
}

// ä¸ºæ±‚å’Œæ–¹æ³•åˆ›å»ºä»£ç†
const proxyAddAll = (function(){
    // æ±‚å’Œç»“æœçš„ç¼“å­˜æ± 
    const resultCache = {}
    return function() {
        // å°†å…¥å‚è½¬åŒ–ä¸ºä¸€ä¸ªå”¯ä¸€çš„å…¥å‚å­—ç¬¦ä¸²
        const args = Array.prototype.join.call(arguments, ',')
        
        // æ£€æŸ¥æœ¬æ¬¡å…¥å‚æ˜¯å¦æœ‰å¯¹åº”çš„è®¡ç®—ç»“æœ
        if(args in resultCache) {
            // å¦‚æœæœ‰ï¼Œåˆ™è¿”å›ç¼“å­˜æ± é‡Œç°æˆçš„ç»“æœ
            return resultCache[args]
        }
        return resultCache[args] = addAll(...arguments)
    }
})()

```

## ä¿æŠ¤ä»£ç†

åœ¨ getter å’Œ setter å‡½æ•°é‡Œå»è¿›è¡Œæ ¡éªŒå’Œæ‹¦æˆªï¼Œç¡®ä¿ä¸€éƒ¨åˆ†å˜é‡æ˜¯å®‰å…¨çš„ã€‚ES6 Proxy

# ç­–ç•¥æ¨¡å¼

> å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•,æŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥, å¹¶ä¸”ä½¿å®ƒä»¬å¯ç›¸äº’æ›¿æ¢ã€‚

```javascript
// å®šä¹‰ä¸€ä¸ªè¯¢ä»·å¤„ç†å™¨å¯¹è±¡
const priceProcessor = {
  pre(originPrice) {
    if (originPrice >= 100) {
      return originPrice - 20;
    }
    return originPrice * 0.9;
  },
  onSale(originPrice) {
    if (originPrice >= 100) {
      return originPrice - 30;
    }
    return originPrice * 0.8;
  },
  back(originPrice) {
    if (originPrice >= 200) {
      return originPrice - 50;
    }
    return originPrice;
  },
  fresh(originPrice) {
    return originPrice * 0.5;
  },
};

// è¯¢ä»·å‡½æ•°
function askPrice(tag, originPrice) {
  return priceProcessor[tag](originPrice)
}

// æ–°å¢ä¸€ä¸ªæ–°äººä»·æ ¼ç®—æ³•
priceProcessor.newUser = function (originPrice) {
  if (originPrice >= 100) {
    return originPrice - 50;
  }
  return originPrice;
}
```

# çŠ¶æ€æ¨¡å¼

> çŠ¶æ€æ¨¡å¼ä¸»è¦è§£å†³çš„æ˜¯å½“æ§åˆ¶ä¸€ä¸ªå¯¹è±¡çŠ¶æ€çš„æ¡ä»¶è¡¨è¾¾å¼è¿‡äºå¤æ‚æ—¶çš„æƒ…å†µã€‚æŠŠçŠ¶æ€çš„åˆ¤æ–­é€»è¾‘è½¬ç§»åˆ°è¡¨ç¤ºä¸åŒçŠ¶æ€çš„ä¸€ç³»åˆ—ç±»ä¸­ï¼Œå¯ä»¥æŠŠå¤æ‚çš„åˆ¤æ–­é€»è¾‘ç®€åŒ–ã€‚

```javascript
class CoffeeMaker {
  constructor() {
    /**
    è¿™é‡Œç•¥å»å’–å•¡æœºä¸­ä¸å’–å•¡çŠ¶æ€åˆ‡æ¢æ— å…³çš„ä¸€äº›åˆå§‹åŒ–é€»è¾‘
  **/
    // åˆå§‹åŒ–çŠ¶æ€ï¼Œæ²¡æœ‰åˆ‡æ¢ä»»ä½•å’–å•¡æ¨¡å¼
    this.state = 'init';
    // åˆå§‹åŒ–ç‰›å¥¶çš„å­˜å‚¨é‡
    this.leftMilk = '500ml';
  }
  stateToProcessor = {
    that: this,
    american() {
      // å°è¯•åœ¨è¡Œä¸ºå‡½æ•°é‡Œæ‹¿åˆ°å’–å•¡æœºå®ä¾‹çš„ä¿¡æ¯å¹¶è¾“å‡º
      console.log('å’–å•¡æœºç°åœ¨çš„ç‰›å¥¶å­˜å‚¨é‡æ˜¯:', this.that.leftMilk)
      console.log('æˆ‘åªåé»‘å’–å•¡');
    },
    latte() {
      this.american()
      console.log('åŠ ç‚¹å¥¶');
    },
    vanillaLatte() {
      this.latte();
      console.log('å†åŠ é¦™è‰ç³–æµ†');
    },
    mocha() {
      this.latte();
      console.log('å†åŠ å·§å…‹åŠ›');
    }
  }

  // å…³æ³¨å’–å•¡æœºçŠ¶æ€åˆ‡æ¢å‡½æ•°
  changeState(state) {
    this.state = state;
    if (!this.stateToProcessor[state]) {
      return;
    }
    this.stateToProcessor[state]();
  }
}

const mk = new CoffeeMaker();
mk.changeState('latte');
```

# è§‚å¯Ÿè€…æ¨¡å¼

å‘å¸ƒ - è®¢é˜…æ¨¡å¼

> è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼Œå½“è¿™ä¸ªç›®æ ‡å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°ã€‚ â€”â€” Graphic Design Patterns

é¦–å…ˆæˆ‘ä»¬æ¥çœ‹è¿™ä¸ªä»£è¡¨å‘å¸ƒè€…çš„ç±»ï¼Œæˆ‘ä»¬ç»™å®ƒèµ·åå«Publisherã€‚è¿™ä¸ªç±»åº”è¯¥å…·å¤‡å“ªäº›â€œåŸºæœ¬æŠ€èƒ½â€å‘¢ï¼Ÿå¤§å®¶å›å¿†ä¸€ä¸‹ä¸Šæ–‡ä¸­çš„éŸ©æ¢…æ¢…ï¼ŒéŸ©æ¢…æ¢…çš„åŸºæœ¬æ“ä½œæ˜¯ä»€ä¹ˆï¼Ÿé¦–å…ˆæ˜¯æ‹‰ç¾¤ï¼ˆå¢åŠ è®¢é˜…è€…ï¼‰ï¼Œç„¶åæ˜¯@æ‰€æœ‰äººï¼ˆé€šçŸ¥è®¢é˜…è€…ï¼‰ï¼Œè¿™ä¿©æ˜¯æœ€æ˜æ˜¾çš„äº†ã€‚æ­¤å¤–ä½œä¸ºç¾¤ä¸»&äº§å“ç»ç†ï¼ŒéŸ©æ¢…æ¢…è¿˜å…·æœ‰è¸¢èµ°é¡¹ç›®ç»„æˆå‘˜ï¼ˆç§»é™¤è®¢é˜…è€…ï¼‰çš„èƒ½åŠ›ã€‚

```javascript
// å®šä¹‰å‘å¸ƒè€…ç±»
class Publisher {
  constructor() {
    this.observers = []
    console.log('Publisher created')
  }
  // å¢åŠ è®¢é˜…è€…
  add(observer) {
    console.log('Publisher.add invoked')
    this.observers.push(observer)
  }
  // ç§»é™¤è®¢é˜…è€…
  remove(observer) {
    console.log('Publisher.remove invoked')
    this.observers.forEach((item, i) => {
      if (item === observer) {
        this.observers.splice(i, 1)
      }
    })
  }
  // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…
  notify() {
    console.log('Publisher.notify invoked')
    this.observers.forEach((observer) => {
      observer.update(this)
    })
  }
}
```

*åˆ›å»ºè®¢é˜…è€…ç±»*

```javascript
// å®šä¹‰è®¢é˜…è€…ç±»
class Observer {
    constructor() {
        console.log('Observer created')
    }

    update() {
        console.log('Observer.update invoked')
    }
}
```

**å®šä¹‰ä¸€ä¸ªå…·ä½“çš„éœ€æ±‚æ–‡æ¡£ï¼ˆprdï¼‰å‘å¸ƒç±»**

```javascript
// å®šä¹‰ä¸€ä¸ªå…·ä½“çš„éœ€æ±‚æ–‡æ¡£ï¼ˆprdï¼‰å‘å¸ƒç±»
class PrdPublisher extends Publisher {
    constructor() {
        super()
        // åˆå§‹åŒ–éœ€æ±‚æ–‡æ¡£
        this.prdState = null
        // éŸ©æ¢…æ¢…è¿˜æ²¡æœ‰æ‹‰ç¾¤ï¼Œå¼€å‘ç¾¤ç›®å‰ä¸ºç©º
        this.observers = []
        console.log('PrdPublisher created')
    }
    
    // è¯¥æ–¹æ³•ç”¨äºè·å–å½“å‰çš„prdState
    getState() {
        console.log('PrdPublisher.getState invoked')
        return this.prdState
    }
    
    // è¯¥æ–¹æ³•ç”¨äºæ”¹å˜prdStateçš„å€¼
    setState(state) {
        console.log('PrdPublisher.setState invoked')
        // prdçš„å€¼å‘ç”Ÿæ”¹å˜
        this.prdState = state
        // éœ€æ±‚æ–‡æ¡£å˜æ›´ï¼Œç«‹åˆ»é€šçŸ¥æ‰€æœ‰å¼€å‘è€…
        this.notify()
    }
}
```

*ä½œä¸ºè®¢é˜…æ–¹ï¼Œå¼€å‘è€…çš„ä»»åŠ¡ä¹Ÿå˜å¾—å…·ä½“èµ·æ¥ï¼šæ¥æ”¶éœ€æ±‚æ–‡æ¡£ã€å¹¶å¼€å§‹å¹²æ´»ï¼š*

```javascript
class DeveloperObserver extends Observer {
    constructor() {
        super()
        // éœ€æ±‚æ–‡æ¡£ä¸€å¼€å§‹è¿˜ä¸å­˜åœ¨ï¼Œprdåˆå§‹ä¸ºç©ºå¯¹è±¡
        this.prdState = {}
        console.log('DeveloperObserver created')
    }
    
    // é‡å†™ä¸€ä¸ªå…·ä½“çš„updateæ–¹æ³•
    update(publisher) {
        console.log('DeveloperObserver.update invoked')
        // æ›´æ–°éœ€æ±‚æ–‡æ¡£
        this.prdState = publisher.getState()
        // è°ƒç”¨å·¥ä½œå‡½æ•°
        this.work()
    }
    
    // workæ–¹æ³•ï¼Œä¸€ä¸ªä¸“é—¨æ¬ç –çš„æ–¹æ³•
    work() {
        // è·å–éœ€æ±‚æ–‡æ¡£
        const prd = this.prdState
        // å¼€å§‹åŸºäºéœ€æ±‚æ–‡æ¡£æä¾›çš„ä¿¡æ¯æ¬ç –ã€‚ã€‚ã€‚
        //...
        console.log('996 begins...')
    }
}
```

*å®Œæ•´æµç¨‹*

```javascript
// åˆ›å»ºè®¢é˜…è€…ï¼šå‰ç«¯å¼€å‘æé›·
const liLei = new DeveloperObserver()
// åˆ›å»ºè®¢é˜…è€…ï¼šæœåŠ¡ç«¯å¼€å‘å°Aï¼ˆsorryã€‚ã€‚ã€‚èµ·åå­—çœŸçš„å¤ªéš¾äº†ï¼‰
const A = new DeveloperObserver()
// åˆ›å»ºè®¢é˜…è€…ï¼šæµ‹è¯•åŒå­¦å°B
const B = new DeveloperObserver()
// éŸ©æ¢…æ¢…å‡ºç°äº†
const hanMeiMei = new PrdPublisher()
// éœ€æ±‚æ–‡æ¡£å‡ºç°äº†
const prd = {
    // å…·ä½“çš„éœ€æ±‚å†…å®¹
    ...
}
// éŸ©æ¢…æ¢…å¼€å§‹æ‹‰ç¾¤
hanMeiMei.add(liLei)
hanMeiMei.add(A)
hanMeiMei.add(B)
// éŸ©æ¢…æ¢…å‘é€äº†éœ€æ±‚æ–‡æ¡£ï¼Œå¹¶@äº†æ‰€æœ‰äºº
hanMeiMei.setState(prd)
```

# è¿­ä»£å™¨æ¨¡å¼

> è¿­ä»£å™¨æ¨¡å¼æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚ â€”â€”ã€Šè®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€ã€‹

## ES6å¯¹è¿­ä»£å™¨çš„å®ç°

åœ¨â€œå…¬å…ƒå‰â€ï¼ŒJSåŸç”Ÿçš„é›†åˆç±»å‹æ•°æ®ç»“æ„ï¼Œåªæœ‰Arrayï¼ˆæ•°ç»„ï¼‰å’ŒObjectï¼ˆå¯¹è±¡ï¼‰ï¼›è€ŒES6ä¸­ï¼Œåˆæ–°å¢äº†Mapå’ŒSetã€‚å››ç§æ•°æ®ç»“æ„å„è‡ªæœ‰ç€è‡ªå·±ç‰¹åˆ«çš„å†…éƒ¨å®ç°ï¼Œä½†æˆ‘ä»¬ä»æœŸå¾…ä»¥åŒæ ·çš„ä¸€å¥—è§„åˆ™å»éå†å®ƒä»¬ï¼Œæ‰€ä»¥ES6åœ¨æ¨å‡ºæ–°æ•°æ®ç»“æ„çš„åŒæ—¶ä¹Ÿæ¨å‡ºäº†ä¸€å¥—**ç»Ÿä¸€çš„æ¥å£æœºåˆ¶**â€”â€”è¿­ä»£å™¨ï¼ˆIteratorï¼‰ã€‚

```javascript
const arr = [1, 2, 3]
// é€šè¿‡è°ƒç”¨iteratorï¼Œæ‹¿åˆ°è¿­ä»£å™¨å¯¹è±¡
const iterator = arr[Symbol.iterator]()

// å¯¹è¿­ä»£å™¨å¯¹è±¡æ‰§è¡Œnextï¼Œå°±èƒ½é€ä¸ªè®¿é—®é›†åˆçš„æˆå‘˜
iterator.next()
iterator.next()
iterator.next()
```

## ç¼–å†™ä¸€ä¸ªè¿­ä»£å™¨ç”Ÿæˆå‡½æ•°

```javascript
// ç¼–å†™ä¸€ä¸ªè¿­ä»£å™¨ç”Ÿæˆå‡½æ•°
function *iteratorGenerator() {
    yield '1å·é€‰æ‰‹'
    yield '2å·é€‰æ‰‹'
    yield '3å·é€‰æ‰‹'
}

const iterator = iteratorGenerator()

iterator.next()
iterator.next()
iterator.next()
```

```javascript
// å®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼Œå…¥å‚æ˜¯ä»»æ„é›†åˆ
function iteratorGenerator(list) {
    // idxè®°å½•å½“å‰è®¿é—®çš„ç´¢å¼•
    var idx = 0
    // lenè®°å½•ä¼ å…¥é›†åˆçš„é•¿åº¦
    var len = list.length
    return {
        // è‡ªå®šä¹‰nextæ–¹æ³•
        next: function() {
            // å¦‚æœç´¢å¼•è¿˜æ²¡æœ‰è¶…å‡ºé›†åˆé•¿åº¦ï¼Œdoneä¸ºfalse
            var done = idx >= len
            // å¦‚æœdoneä¸ºfalseï¼Œåˆ™å¯ä»¥ç»§ç»­å–å€¼
            var value = !done ? list[idx++] : undefined
            
            // å°†å½“å‰å€¼ä¸éå†æ˜¯å¦å®Œæ¯•ï¼ˆdoneï¼‰è¿”å›
            return {
                done: done,
                value: value
            }
        }
    }
}

var iterator = iteratorGenerator(['1å·é€‰æ‰‹', '2å·é€‰æ‰‹', '3å·é€‰æ‰‹'])
iterator.next()
iterator.next()
iterator.next()
```

# å‘½ä»¤æ¨¡å¼

# è´£ä»»é“¾æ¨¡å¼

# äº«å…ƒæ¨¡å¼

# è®¾è®¡æ¨¡å¼ç›¸å…³ä¹¦ç±

## Head First è®¾è®¡æ¨¡å¼ï¼ˆä¸­æ–‡ç‰ˆï¼‰

## è®¾è®¡æ¨¡å¼ï¼šå¯å¤ç”¨é¢å‘å¯¹è±¡è½¯ä»¶çš„åŸºç¡€