---
layout:     post
title:      "javascript 代码是如何被浏览器执行的"
subtitle:   " 🎯 "
date:       2019-12-10 12:00:00
author:     "Hiz"
header-img: "img/post-bg-js-version.jpg"
catalog: true
tags:
    - Javascript
    - Javascript 进阶
---

通过V8引擎，先把js代码转化成AST，然后通过解释器将AST转成字码节，在通过编译器将字码节转成机器码，最后在进行垃圾回收， 至此整个js的执行就完成了。

javascript 是解释型语言，它与Java/C++等编译型语言不同，虽然都需要将代码装换为机器码，区别在于转换的时机。javascript是运行时编译，而Java/C++等是代码运行前编译器已经将代码转换成机器码了。所以javascript的运行效率要比编译型语言要慢。因为它每次执行都需要将源码进行转换

# V8 引擎执行 JS 代码经过的阶段。

* Parse阶段：V8引擎将js代码转换成抽象语法树

  * 词法分析：将代码拆分成最小的、不可拆分的单元。称之为`token`

    ```javascript
    var a = 1;
    // 将会被分解成 var、 a 、= 、 1、；五个部分空格忽略
    ```

  * 语法分析：将词法单元转换成一个由元素逐渐嵌套所组成的代表了程序语法结构的树。也称之为`抽象语法树`

* Ignition阶段：解释器将AST转换成字节码，也为下一个阶段优化编译提供必要的信息

* TurboFan阶段：编译器利用上个阶段收集的信息，将字节码优化为可以执行的机器码

  在 Ignition 解释器处理完之后，如果发现一段代码被重复执行多次的情况，会被标记成为热点代码，生成的字节码以及分析数据会传给 TurboFan 编译器，它会根据分析数据的情况生成优化好的机器码。再执行这段代码之后，只需要直接执行编译后的机器码，这样性能就会更好。

* Orinoco阶段：垃圾回收阶段，对程序中不使用的内存空间进行回收。

# 抽象语法树的应用

* JS 反编译、词法分析
* Babel编译ES6语法
* 代码高亮
* 关键字匹配
* 代码压缩

Babel将Es6转换成ES5的过程就是将 ES6 源码解析成 AST，再将 ES6 语法的抽象语法树转成 ES5 的抽象语法树，最后利用它来生成 ES5 的源代码。

[AST 在线转换](https://astexplorer.net/)

